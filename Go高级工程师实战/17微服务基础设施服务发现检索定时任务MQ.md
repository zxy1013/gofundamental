**服务发现**

为什么要做服务发现，因为微服务拆分后需要api但是ip不能写死，因为物理机可能会变

![1639708814135](F:\markdown笔记\Go高级工程师实战\image\1639708814135.png)

**服务发现的分类** 服务端和客户端

LB可以是nginx 维护upstring upstring动态更新 但是nginx是单点

![1639708888605](F:\markdown笔记\Go高级工程师实战\image\1639708888605.png)

客户端服务发现是将中心基础设施去掉 将服务中心放到外部注册中心，服务定时注册自己的端口注册到服务中心中

![1639709039269](F:\markdown笔记\Go高级工程师实战\image\1639709039269.png)

**开源的注册中心**

![1639709685806](F:\markdown笔记\Go高级工程师实战\image\1639709685806.png)

DNS 将间隔变小就类似于注册中心

![1639709851588](F:\markdown笔记\Go高级工程师实战\image\1639709851588.png)

**全文检索** 

垂直搜索场景（本地数据 不需爬虫）一般用ES做， es主要用来做检索

![1639710114072](F:\markdown笔记\Go高级工程师实战\image\1639710114072.png)

![1639710196056](F:\markdown笔记\Go高级工程师实战\image\1639710196056.png)

![1639710314649](F:\markdown笔记\Go高级工程师实战\image\1639710314649.png)

新插入的数据经过一段时间后refresh_interval才可被用户查询

![1639710334220](F:\markdown笔记\Go高级工程师实战\image\1639710334220.png)

segment不可变 所以删除即增加

![1639710399996](F:\markdown笔记\Go高级工程师实战\image\1639710399996.png)

![1639710458276](F:\markdown笔记\Go高级工程师实战\image\1639710458276.png)

**扩容** 新版本扩容支持三种模式

![1639710550878](F:\markdown笔记\Go高级工程师实战\image\1639710550878.png)

![1639711191895](F:\markdown笔记\Go高级工程师实战\image\1639711191895.png)

**定时任务**

![1639712441629](F:\markdown笔记\Go高级工程师实战\image\1639712441629.png)

物理机挂了 定时任务失效

![1639712554664](F:\markdown笔记\Go高级工程师实战\image\1639712554664.png)

分布式配置是全局的 一个有问题会选举出一个新的master

![1639712566743](F:\markdown笔记\Go高级工程师实战\image\1639712566743.png)

定时任务执行的流程 写日志同步所有master节点 未执行完成挂掉后新master重新执行 要求执行任务需要幂等，因为可能会部分成功

![1639712675091](F:\markdown笔记\Go高级工程师实战\image\1639712675091.png)

**消息队列**

消息系统

![1639713245815](F:\markdown笔记\Go高级工程师实战\image\1639713245815.png)

保证最终一致性

![1639713472042](F:\markdown笔记\Go高级工程师实战\image\1639713472042.png)

**折衷方案**

![1639713933861](F:\markdown笔记\Go高级工程师实战\image\1639713933861.png)

**延迟消息**

![1639714045551](F:\markdown笔记\Go高级工程师实战\image\1639714045551.png)

**使用场景**

![1639714070738](F:\markdown笔记\Go高级工程师实战\image\1639714070738.png)

**kafka** 一个kafka集群有多个broker 即一个kafka实例

![1639726602939](F:\markdown笔记\Go高级工程师实战\image\1639726602939.png)

![1639727268455](F:\markdown笔记\Go高级工程师实战\image\1639727268455.png)

![1639727291604](F:\markdown笔记\Go高级工程师实战\image\1639727291604.png)

consumer增加到一定程度上会导致空闲，所以需要运维人员手动分裂partition

![1639727734390](F:\markdown笔记\Go高级工程师实战\image\1639727734390.png)

**pulsar** broker不管存储 只是一个无状态的服务

![1639728882393](F:\markdown笔记\Go高级工程师实战\image\1639728882393.png)

保证大部分是顺序执行的

![1639728926456](F:\markdown笔记\Go高级工程师实战\image\1639728926456.png)

![1639729346979](F:\markdown笔记\Go高级工程师实战\image\1639729346979.png)

![1639730321881](F:\markdown笔记\Go高级工程师实战\image\1639730321881.png)

​	